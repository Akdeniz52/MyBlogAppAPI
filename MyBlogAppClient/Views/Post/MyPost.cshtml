<div class="row">
    <div class="col-12">
        <div class="bg-white p-4">
            <h1>Post List</h1>
            <a href="/post/create" class="btn btn-primary mb-3">New Post</a>
            <table class="table table-bordered" id="postTable">
                <thead>
                    <tr>
                        <th style="width: 200px;">Image</th>
                        <th>Title</th>
                        <th>IsActive</th>
                        <th style="width: 125px"></th>
                    </tr>
                </thead>
                <tbody id="postTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("token");
        const response = await fetch("http://localhost:5261/api/posts/my-post-list", {
            headers: {
                "Authorization": `Bearer ${token}`
            }
        });

        if (!response.ok) {
            alert("Postlar alınırken hata oluştu.");
            return;
        }

        const posts = await response.json();
        const tbody = document.getElementById("postTableBody");
        tbody.innerHTML = "";  

        posts.forEach(post => {
            const row = document.createElement("tr");

            row.innerHTML = `
                <td><img src="${post.image}" alt="" class="img-fluid" style="max-width:150px;"></td>
                <td>${post.title}</td>
                <td>${post.isActive}</td>
                <td>
                    <a href="/post/edit/${post.postId}" class="btn btn-sm btn-primary">Edit</a>
                    <button class="btn btn-sm btn-danger delete-btn" data-id="${post.postId}">Delete</button>
                </td>
            `;

            tbody.appendChild(row);
        });

        
        document.querySelectorAll(".delete-btn").forEach(button => {
            button.addEventListener("click", async () => {
                const postId = button.getAttribute("data-id");
                if (!confirm("Bu postu silmek istediğinize emin misiniz?")) return;

                const deleteResponse = await fetch(`http://localhost:5261/api/posts/delete/${postId}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`
                    }
                });

                if (deleteResponse.ok) {
                    alert("Post başarıyla silindi.");
                 
                    button.closest("tr").remove();
                } else {
                    const errorText = await deleteResponse.text();
                    alert("Silme başarısız: " + errorText);
                }
            });
        });
    });
</script>
